<html lang="en"><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" /><meta content="Adrian Smith" name="author" /><link href="dewey-analysis/favicon.ico" rel="icon" /><title>Analyzing Every Clojure Project on Github</title><script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script><script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script><link href="dewey-analysis/bootstrap.min.css" rel="stylesheet" /><link href="dewey-analysis/blog.css" rel="stylesheet" /><style type="text/css">.syntax pre {
  background: ;
}

.syntax pre .definition {
  color: #00f;
}

.syntax pre .core-fn {
  color: #30a;
}

.syntax pre .variable {
  color: black;
}

.syntax pre .number {
  color: #164;
}

.syntax pre .s-exp {
  color: #997;
}

.syntax pre .special-form {
  color: #30a;
}

.syntax pre .string {
  color: #a11;
}

.syntax pre .keyword {
  color: #708;
}

.syntax pre .macro {
  color: #05a;
}

.syntax pre .reader-char {
  color: #555;
}

.syntax pre .nil {
  color: #164;
}

.syntax pre .comment {
  color: #a50;
}

.syntax pre .repeat {
  color: #f00;
}

.syntax pre .regex {
  color: #f50;
}

.syntax pre .exception {
  color: #f00;
}

.syntax pre .boolean {
  color: #164;
}

.syntax pre .character {
  color: #f50;
}

.syntax pre .conditional {
  color: #30a;
} div.syntax { padding: 4px ; background-color: #f8f8f8; margin-bottom: 18px } div.syntax pre { margin-bottom: 0 }</style></head><body><div class="blog-masthead"><div class="container"><nav class="nav blog-nav"><a class="nav-link" href="/">Home</a></nav></div></div><div class="blog-header"><div class="container"><h1 class="blog-title">Analyzing Every Clojure Project on Github</h1><p class="lead blog-description"></p></div></div><div class="container"><div class="row"><div class="col-sm-8 blog-main"><div class="blog-post"><div><ul><li><a href="#Introduction">Introduction</a></li><li><a href="#Results">Results</a></li><ul><li><a href="#Hidden-Gems">Hidden Gems</a></li><ul><li><a href="#pvalues-and-pcalls">pvalues and pcalls</a></li><li><a href="#parse-">parse-*</a></li><li><a href="#iteration">iteration</a></li><li><a href="#min-key-and-max-key">min-key and max-key</a></li><li><a href="#random-uuid">random-uuid</a></li></ul><li><a href="#Usage-of-clojurecore-functions-added-in-110-and-111">Usage of clojure.core functions added in 1.10 and 1.11</a></li><li><a href="#Reference-type-usage">Reference type usage</a></li><li><a href="#Var-Definitions-and-Macros">Var Definitions and Macros</a></li><li><a href="#Lein-vs-deps">Lein vs deps</a></li><li><a href="#Local-names">Local names</a></li><ul><li><a href="#Local-name-lengths">Local name lengths</a></li><li><a href="#Local-binding-names-that-are-a-single-letter">Local binding names that are a single letter</a></li></ul><li><a href="#Emoji-and-unicode-in-names">Emoji and unicode in names</a></li></ul><li><a href="#Failed-Analyses">Failed Analyses</a></li><li><a href="#Biases">Biases</a></li><li><a href="#Future-Work">Future Work</a></li><ul><li><a href="#Mundane-Improvements">Mundane Improvements</a></li><li><a href="#Use-a-database">Use a database</a></li><li><a href="#Example-Usages">Example Usages</a></li><li><a href="#Improved-Code-Search">Improved Code Search</a></li><li><a href="#JavaJavascript-Interop">Java/Javascript Interop</a></li><li><a href="#Clojure-Specs">Clojure Specs</a></li><li><a href="#N-grams">N-grams</a></li><li><a href="#Namespace-Alias-usage">Namespace Alias usage</a></li></ul><li><a href="#Related-Work">Related Work</a></li><li><a href="#Footnotes">Footnotes</a></li></ul><p>Posted: September 6th, 2022<br /><strong>Update</strong>: September 7th, 2022. Added <a href="http://localhost:8000/dewey-analysis.html#Failed-Analyses">Failed Analyses</a> section and fixed total repository count.</p><p><em>See <a href="https://github.com/phronmophobic/blog/blob/master/markdown/dewey-analysis.md">source</a> for full history.</em></p><h1 id="Introduction">Introduction</h1><p>I&apos;m generally interested in tools like <a href="https://cljdoc.org/">cljdoc</a> that work at the ecosystem level. As part of my work on <a href="https://github.com/phronmophobic/dewey">dewey</a>, which builds an index of all clojure libraries on github, I thought it would be a straightforward extension to statically analyze all the projects found. A bare, shallow checkout of every clojure project found by dewey<sup><a href="#footnote-1" name="footnote-ref-1" title="Nine projects were excluded because they are ginormous by themselves.">1</a></sup> is only about 14GB, which is a very tractable size.</p><p>There&apos;s also a couple of features of the clojure ecosystem that make it an interesting target for wholesale analysis:</p><ul><li><p>libraries address a wide range of problems</p></li><li><p>libraries tend to be stable and concise</p></li><li><p>clojure syntax is regular and minimal</p></li><li><p>clojure has strong support and conventions for namespaces</p></li></ul><p>There are several tools available for analysis. Projects like cljdoc and <a href="https://github.com/devn/getclojure">getclojure</a> use dynamic analysis, but for this initial run, I chose to use <a href="https://github.com/clj-kondo/clj-kondo/tree/master/analysis">clj-kondo&apos;s static analysis</a>. Given a project, clj-kondo will report<sup><a href="#footnote-2" name="footnote-ref-2" title="Clj-kondo also allows you to write your own linters, but that will have to wait for a future update.">2</a></sup>:</p><ul><li><p>namespace definitions and usages</p></li><li><p>locals and usages</p></li><li><p>var definitions and usages</p></li><li><p>keywords</p></li><li><p>protocol implementations</p></li></ul><p><strong>Analysis Rate</strong>: 87%</p><p>Out of the 13,274 repositories found by dewey on github, 11,573 (87%) were successfully<sup><a href="#footnote-3" name="footnote-ref-3" title="See [Failed Analyses](#Failed-Analyses).">3</a></sup> analyzed.</p><h1 id="Results">Results</h1><p>The main goal of this project is to make the resulting analyses available for other projects and tools to consume. The full analysis of projects can be found under the <a href="https://github.com/phronmophobic/dewey/releases">dewey releases</a> in the <code>analysis.edn.gz</code> file.</p><p>In addition to providing the data, I also wanted to do some cursory investigation based on the analyses which I present below.</p><h2 id="Hidden-Gems">Hidden Gems</h2><p>The clojure.core library is <span title="teehee">rich</span> and I always seem to find useful nuggets that I&apos;ve somehow missed. Just to make sure that I&apos;m not the only person with clojure.core FOMO, I thought I&apos;d share some hidden gems found among the least used public clojure.core vars. To be fair, many of these functions are recent additions, but not all of them!</p><h3 id="pvalues-and-pcalls">pvalues and pcalls</h3><p>I&apos;ll often use <code>pmap</code> for quick and dirty parallel computation. <code>pvalues</code>(15 usages) and <code>pcalls</code>(19 usages) also seem useful for quick and dirty parallelization.</p><p><code>(pvalues &amp; exprs)</code>: Returns a lazy sequence of the values of the exprs, which are evaluated in parallel.<br /><code>(pcalls &amp; fns)</code>: Executes the no-arg fns in parallel, returning a lazy sequence of their values.</p><h3 id="parse-">parse-*</h3><p>The core library added a handful of useful parse-* functions in <code>1.11</code> like <code>parse-double</code>(26 usages), <code>parse-boolean</code> (6 usages), <code>parse-long</code>(202 usages), <code>parse-uuid</code>(25 usages). They do basically what you would expect. I usually search for the proper java interop call or go the lazy route and just use <code>read-string</code>. I&apos;m happy to have a better alternative now.</p><h3 id="iteration">iteration</h3><p>Another gem is <code>iteration</code> (11 usages, once by <a href="https://github.com/phronmophobic/dewey/blob/b5c29261ca1feed4c213606499c5160305e1b622/src/com/phronemophobic/dewey.clj#L57">dewey itself!</a>) which was added in <code>1.11</code>. The doc string doesn&apos;t immediately illuminate why or how to use it, but it&apos;s great. Check it out!<sup><a href="#footnote-4" name="footnote-ref-4" title="Here&apos;s a blog post explaining more about `iteration`. [https://www.juxt.pro/blog/new-clojure-iteration](https://www.juxt.pro/blog/new-clojure-iteration) ">4</a></sup></p><h3 id="min-key-and-max-key">min-key and max-key</h3><p>Two functions that I think are criminally under used are <code>min-key</code>(256 usages) and <code>max-key</code>(431 usages). They tend to get overshadowed by their much more popular cousin, <code>sort-by</code> (4,926 usages), but are still useful in their own right.</p><div class="syntax"><pre><span class="s-exp">(</span><span class="core-fn">min-key</span> <span class="symbol">k</span> <span class="symbol">x</span><span class="s-exp">)</span>
<span class="s-exp">(</span><span class="core-fn">min-key</span> <span class="symbol">k</span> <span class="symbol">x</span> <span class="symbol">y</span><span class="s-exp">)</span>
<span class="s-exp">(</span><span class="core-fn">min-key</span> <span class="symbol">k</span> <span class="symbol">x</span> <span class="symbol">y</span> <span class="reader-char">&amp;</span> <span class="symbol">more</span><span class="s-exp">)</span>
</pre></div><pre><code>Returns the x for which (k x), a number, is least. 
If there are multiple such xs, the last one is returned.
</code></pre><p><code>max-key</code> is the same, but different.</p><h3 id="random-uuid">random-uuid</h3><p><code>random-uuid</code>(60 usages) is another <code>1.11</code> addition and a welcome one.</p><h2 id="Usage-of-clojurecore-functions-added-in-110-and-111">Usage of clojure.core functions added in 1.10 and 1.11</h2><p>There&apos;s always a delay between new clojure versions and projects getting around to adopting and leveraging the latest additions. I was curious which of the latest features were gaining traction.</p>
<div id="viz_27281"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27281 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":"description","data":{"values":[{"c":818,"name":"ex-message","added":"1.10"},{"c":412,"name":"abs","added":"1.11"},{"c":301,"name":"requiring-resolve","added":"1.10"},{"c":202,"name":"parse-long","added":"1.11"},{"c":104,"name":"tap>","added":"1.10"},{"c":102,"name":"ex-cause","added":"1.10"},{"c":67,"name":"add-tap","added":"1.10"},{"c":66,"name":"update-vals","added":"1.11"},{"c":60,"name":"random-uuid","added":"1.11"},{"c":26,"name":"parse-double","added":"1.11"},{"c":25,"name":"parse-uuid","added":"1.11"},{"c":22,"name":"update-keys","added":"1.11"},{"c":19,"name":"remove-tap","added":"1.10"},{"c":16,"name":"PrintWriter-on","added":"1.10"},{"c":11,"name":"iteration","added":"1.11"},{"c":9,"name":"infinite?","added":"1.11"},{"c":7,"name":"NaN?","added":"1.11"},{"c":6,"name":"parse-boolean","added":"1.11"},{"c":5,"name":"read+string","added":"1.10"},{"c":2,"name":"seq-to...ucturing*","added":"1.11"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"c","type":"nominal"}}}],"encoding":{"x":{"field":"c","type":"quantitative","title":"usage count"},"color":{"field":"added","legend":{"orient":"bottom"},"type":"nominal"},"y":{"field":"name","type":"nominal","title":null,"sort":{"field":"c","op":"max"}}}};
      vegaEmbed('#viz_27281', yourVlSpec_viz_27281, {actions: false});
    </script><p>* seq-to-map-for-destructuring<sup><a href="#footnote-5" name="footnote-ref-5" title="CSS is hard">5</a></sup></p><h2 id="Reference-type-usage">Reference type usage</h2><div style="width:100%;overflow:scroll;">
<div id="viz_27282"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27282 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"count":2000,"count str":"2,000","ref type":"ref"},{"_index":1,"count":18592,"count str":"18,592","ref type":"atom"},{"_index":2,"count":581,"count str":"581","ref type":"agent"},{"_index":3,"count":1329,"count str":"1,329","ref type":"volatile!"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"count str","type":"nominal"}}}],"encoding":{"x":{"field":"count","type":"quantitative"},"y":{"field":"ref type","type":"nominal","sort":{"field":"count","op":"max"}}}};
      vegaEmbed('#viz_27282', yourVlSpec_viz_27282, {actions: false});
    </script></div><p>The results match my expectation that <code>atom</code> is, by far, the most common reference type. It was interesting to see that <code>ref</code> usage is higher than <code>volatile!</code>, but <code>volatile!</code> is much newer. I&apos;m not surprised that <code>agent</code> is the least used reference type.</p><p><strong>Average mutable reference usage per repository</strong>: 1.94<br /><strong>Repositories with no mutable reference usages</strong>: 7,245 (63%)</p><p>Truly bananas. Clojure libraries really do have less state. It probably isn&apos;t surprising if you&apos;ve been programming in clojure for any length of time, but it&apos;s pretty wild to see the data back this up. I don&apos;t think I would have believed this 10 years ago.</p><h2 id="Var-Definitions-and-Macros">Var Definitions and Macros</h2><div style="width:100%;overflow:scroll;">
<div id="viz_27283"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27283 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"percentage":2.0203450981924513,"percentage str":"2.02","def type":"declare"},{"_index":1,"percentage":21.65492785761036,"percentage str":"21.65","def type":"def"},{"_index":2,"percentage":0.04884386569890687,"percentage str":"0.05","def type":"definline"},{"_index":3,"percentage":0.016769727223291363,"percentage str":"0.02","def type":"definterface"},{"_index":4,"percentage":2.931853038576885,"percentage str":"2.93","def type":"defmacro"},{"_index":5,"percentage":0.8088544159738978,"percentage str":"0.81","def type":"defmulti"},{"_index":6,"percentage":63.55620789251745,"percentage str":"63.56","def type":"defn"},{"_index":7,"percentage":0.9233932810378345,"percentage str":"0.92","def type":"defonce"},{"_index":8,"percentage":3.8424655080901724,"percentage str":"3.84","def type":"defprotocol"},{"_index":9,"percentage":3.2857268455654656,"percentage str":"3.29","def type":"defrecord"},{"_index":10,"percentage":0.9106124695132871,"percentage str":"0.91","def type":"deftype"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"percentage str","type":"nominal"}}}],"encoding":{"x":{"field":"percentage","type":"quantitative"},"y":{"field":"def type","type":"nominal","sort":{"field":"percentage","op":"max"}}}};
      vegaEmbed('#viz_27283', yourVlSpec_viz_27283, {actions: false});
    </script></div><p><strong>total var definitions</strong>: 1,228,404</p><p>Most var definitions are functions. No surprise. I am sort of surprised that over 20% of vars are <code>def</code>s. What are people <code>def</code>ing all over the place? That&apos;s something I would like to follow up on at some point.</p><p>I consider <code>defprotocol</code> to be an important, fundamental building block, so to see that <code>defmacro</code> usage (2.93%) is similar to <code>defprotocol</code> usage (3.84%) is interesting.</p><h2 id="Lein-vs-deps">Lein vs deps</h2><div style="width:100%;overflow:scroll;">
<div id="viz_27284"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27284 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"count":9790,"count str":"9,790","project type":"lein"},{"_index":1,"count":1405,"count str":"1,405","project type":"deps"},{"_index":2,"count":505,"count str":"505","project type":"deps+lein"},{"_index":3,"count":1574,"count str":"1,574","project type":"neither"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"count str","type":"nominal"}}}],"encoding":{"x":{"field":"count","type":"quantitative"},"y":{"field":"project type","type":"nominal","sort":{"field":"count","op":"max"}}}};
      vegaEmbed('#viz_27284', yourVlSpec_viz_27284, {actions: false});
    </script></div><p>These numbers don&apos;t directly match the latest <a href="https://clojure.org/news/2022/06/02/state-of-clojure-2022">state of clojure</a> numbers (ie. over 50% deps.edn usage), but I don&apos;t think they&apos;re inconsistent since clojure repositories on github will be weighted towards older projects.</p><p>The &quot;neither&quot; category means that no <code>deps.edn</code> or <code>project.clj</code> file was found. Many of them were shadow-cljs projects. Detecting other build tools would be a good improvement in the future.</p><h2 id="Local-names">Local names</h2><p>Clojurians like using short local variable names and this proves it!</p><h3 id="Local-name-lengths">Local name lengths</h3><div style="width:100%;overflow:scroll;">
<div id="viz_27285"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27285 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"count":757732,"count str":"757,732","local name length":"1"},{"_index":1,"count":257745,"count str":"257,745","local name length":"2"},{"_index":2,"count":348750,"count str":"348,750","local name length":"3"},{"_index":3,"count":628377,"count str":"628,377","local name length":"4"},{"_index":4,"count":155951,"count str":"155,951","local name length":"\"_\""},{"_index":5,"count":362796,"count str":"362,796","local name length":"5"},{"_index":6,"count":303371,"count str":"303,371","local name length":"6"},{"_index":7,"count":273346,"count str":"273,346","local name length":"7"},{"_index":8,"count":213330,"count str":"213,330","local name length":"8"},{"_index":9,"count":171295,"count str":"171,295","local name length":"9"},{"_index":10,"count":140454,"count str":"140,454","local name length":"10"},{"_index":11,"count":103798,"count str":"103,798","local name length":"11"},{"_index":12,"count":81235,"count str":"81,235","local name length":"12"},{"_index":13,"count":62657,"count str":"62,657","local name length":"13"},{"_index":14,"count":44340,"count str":"44,340","local name length":"14"},{"_index":15,"count":35847,"count str":"35,847","local name length":"15"},{"_index":16,"count":29827,"count str":"29,827","local name length":"16"},{"_index":17,"count":18797,"count str":"18,797","local name length":"17"},{"_index":18,"count":13279,"count str":"13,279","local name length":"18"},{"_index":19,"count":10194,"count str":"10,194","local name length":"19"},{"_index":20,"count":7604,"count str":"7,604","local name length":"20"},{"_index":21,"count":11310,"count str":"11,310","local name length":"21"},{"_index":22,"count":4581,"count str":"4,581","local name length":"22"},{"_index":23,"count":3387,"count str":"3,387","local name length":"23"},{"_index":24,"count":3257,"count str":"3,257","local name length":"24"},{"_index":25,"count":1549,"count str":"1,549","local name length":"25"},{"_index":26,"count":1316,"count str":"1,316","local name length":"26"},{"_index":27,"count":1225,"count str":"1,225","local name length":"27"},{"_index":28,"count":753,"count str":"753","local name length":"28"},{"_index":29,"count":655,"count str":"655","local name length":"29"},{"_index":30,"count":569,"count str":"569","local name length":"30"},{"_index":31,"count":349,"count str":"349","local name length":"31"},{"_index":32,"count":386,"count str":"386","local name length":"32"},{"_index":33,"count":191,"count str":"191","local name length":"33"},{"_index":34,"count":188,"count str":"188","local name length":"34"},{"_index":35,"count":141,"count str":"141","local name length":"35"},{"_index":36,"count":192,"count str":"192","local name length":"36"},{"_index":37,"count":252,"count str":"252","local name length":"37"},{"_index":38,"count":104,"count str":"104","local name length":"38"},{"_index":39,"count":103,"count str":"103","local name length":"39"},{"_index":40,"count":124,"count str":"124","local name length":"40"},{"_index":41,"count":38,"count str":"38","local name length":"41"},{"_index":42,"count":23,"count str":"23","local name length":"42"},{"_index":43,"count":19,"count str":"19","local name length":"43"},{"_index":44,"count":14,"count str":"14","local name length":"44"},{"_index":45,"count":10,"count str":"10","local name length":"45"},{"_index":46,"count":11,"count str":"11","local name length":"46"},{"_index":47,"count":5,"count str":"5","local name length":"47"},{"_index":48,"count":14,"count str":"14","local name length":"48"},{"_index":49,"count":6,"count str":"6","local name length":"49"},{"_index":50,"count":7,"count str":"7","local name length":"50"},{"_index":51,"count":2,"count str":"2","local name length":"51"},{"_index":52,"count":3,"count str":"3","local name length":"52"},{"_index":53,"count":1,"count str":"1","local name length":"53"},{"_index":54,"count":1,"count str":"1","local name length":"54"},{"_index":55,"count":2,"count str":"2","local name length":"56"},{"_index":56,"count":3,"count str":"3","local name length":"59"},{"_index":57,"count":1,"count str":"1","local name length":"61"},{"_index":58,"count":1,"count str":"1","local name length":"62"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"count str","type":"nominal"}}}],"encoding":{"x":{"field":"count","type":"quantitative"},"y":{"field":"local name length","type":"nominal","sort":{"field":"count","op":"max"}}}};
      vegaEmbed('#viz_27285', yourVlSpec_viz_27285, {actions: false});
    </script></div><p>The most common local name is <code>_</code> with 155,951 followed by <code>this</code> at 92,296. I&apos;m not sure what it says that 4% of locals are throw aways. What a waste.</p><h3 id="Local-binding-names-that-are-a-single-letter">Local binding names that are a single letter</h3><div style="width:100%;overflow:scroll;">
<div id="viz_27286"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27286 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"count":2,"count str":"2","local name":"\ucd9c"},{"_index":1,"count":2,"count str":"2","local name":"\uc785"},{"_index":2,"count":2,"count str":"2","local name":"\uac12"},{"_index":3,"count":3,"count str":"3","local name":"\u2733"},{"_index":4,"count":2,"count str":"2","local name":"\u0b86"},{"_index":5,"count":1,"count str":"1","local name":"\u0441"},{"_index":6,"count":2,"count str":"2","local name":"\u03f5"},{"_index":7,"count":12,"count str":"12","local name":"\u03d5"},{"_index":8,"count":6,"count str":"6","local name":"\u03c9"},{"_index":9,"count":11,"count str":"11","local name":"\u03c8"},{"_index":10,"count":34,"count str":"34","local name":"\u03c6"},{"_index":11,"count":3,"count str":"3","local name":"\u03c4"},{"_index":12,"count":34,"count str":"34","local name":"\u03c3"},{"_index":13,"count":2,"count str":"2","local name":"\u03c1"},{"_index":14,"count":2,"count str":"2","local name":"\u03c0"},{"_index":15,"count":4,"count str":"4","local name":"\u03bc"},{"_index":16,"count":5,"count str":"5","local name":"\u03bb"},{"_index":17,"count":1,"count str":"1","local name":"\u03ba"},{"_index":18,"count":98,"count str":"98","local name":"\u03b8"},{"_index":19,"count":1,"count str":"1","local name":"\u03b7"},{"_index":20,"count":17,"count str":"17","local name":"\u03b5"},{"_index":21,"count":21,"count str":"21","local name":"\u03b4"},{"_index":22,"count":10,"count str":"10","local name":"\u03b3"},{"_index":23,"count":11,"count str":"11","local name":"\u03b2"},{"_index":24,"count":38,"count str":"38","local name":"\u03b1"},{"_index":25,"count":3,"count str":"3","local name":"\u03a9"},{"_index":26,"count":8,"count str":"8","local name":"\u03a3"},{"_index":27,"count":1,"count str":"1","local name":"\u03a0"},{"_index":28,"count":3,"count str":"3","local name":"\u0394"},{"_index":29,"count":2,"count str":"2","local name":"\u00f8"},{"_index":30,"count":20,"count str":"20","local name":"|"},{"_index":31,"count":4145,"count str":"4,145","local name":"z"},{"_index":32,"count":27908,"count str":"27,908","local name":"y"},{"_index":33,"count":75792,"count str":"75,792","local name":"x"},{"_index":34,"count":8251,"count str":"8,251","local name":"w"},{"_index":35,"count":50609,"count str":"50,609","local name":"v"},{"_index":36,"count":2805,"count str":"2,805","local name":"u"},{"_index":37,"count":16770,"count str":"16,770","local name":"t"},{"_index":38,"count":38352,"count str":"38,352","local name":"s"},{"_index":39,"count":14911,"count str":"14,911","local name":"r"},{"_index":40,"count":5564,"count str":"5,564","local name":"q"},{"_index":41,"count":16929,"count str":"16,929","local name":"p"},{"_index":42,"count":8306,"count str":"8,306","local name":"o"},{"_index":43,"count":29860,"count str":"29,860","local name":"n"},{"_index":44,"count":35856,"count str":"35,856","local name":"m"},{"_index":45,"count":6066,"count str":"6,066","local name":"l"},{"_index":46,"count":43163,"count str":"43,163","local name":"k"},{"_index":47,"count":3849,"count str":"3,849","local name":"j"},{"_index":48,"count":20805,"count str":"20,805","local name":"i"},{"_index":49,"count":7044,"count str":"7,044","local name":"h"},{"_index":50,"count":9868,"count str":"9,868","local name":"g"},{"_index":51,"count":41873,"count str":"41,873","local name":"f"},{"_index":52,"count":35583,"count str":"35,583","local name":"e"},{"_index":53,"count":11255,"count str":"11,255","local name":"d"},{"_index":54,"count":23209,"count str":"23,209","local name":"c"},{"_index":55,"count":23039,"count str":"23,039","local name":"b"},{"_index":56,"count":32925,"count str":"32,925","local name":"a"},{"_index":57,"count":155951,"count str":"155,951","local name":"_"},{"_index":58,"count":51,"count str":"51","local name":"Z"},{"_index":59,"count":373,"count str":"373","local name":"Y"},{"_index":60,"count":650,"count str":"650","local name":"X"},{"_index":61,"count":62,"count str":"62","local name":"W"},{"_index":62,"count":171,"count str":"171","local name":"V"},{"_index":63,"count":84,"count str":"84","local name":"U"},{"_index":64,"count":248,"count str":"248","local name":"T"},{"_index":65,"count":608,"count str":"608","local name":"S"},{"_index":66,"count":218,"count str":"218","local name":"R"},{"_index":67,"count":116,"count str":"116","local name":"Q"},{"_index":68,"count":181,"count str":"181","local name":"P"},{"_index":69,"count":22,"count str":"22","local name":"O"},{"_index":70,"count":309,"count str":"309","local name":"N"},{"_index":71,"count":379,"count str":"379","local name":"M"},{"_index":72,"count":204,"count str":"204","local name":"L"},{"_index":73,"count":91,"count str":"91","local name":"K"},{"_index":74,"count":40,"count str":"40","local name":"J"},{"_index":75,"count":68,"count str":"68","local name":"I"},{"_index":76,"count":98,"count str":"98","local name":"H"},{"_index":77,"count":95,"count str":"95","local name":"G"},{"_index":78,"count":105,"count str":"105","local name":"F"},{"_index":79,"count":132,"count str":"132","local name":"E"},{"_index":80,"count":134,"count str":"134","local name":"D"},{"_index":81,"count":294,"count str":"294","local name":"C"},{"_index":82,"count":302,"count str":"302","local name":"B"},{"_index":83,"count":611,"count str":"611","local name":"A"},{"_index":84,"count":36,"count str":"36","local name":"?"},{"_index":85,"count":3,"count str":"3","local name":">"},{"_index":86,"count":4,"count str":"4","local name":"="},{"_index":87,"count":3,"count str":"3","local name":"<"},{"_index":88,"count":15,"count str":"15","local name":"-"},{"_index":89,"count":18,"count str":"18","local name":"+"},{"_index":90,"count":60,"count str":"60","local name":"*"},{"_index":91,"count":123,"count str":"123","local name":"%"},{"_index":92,"count":757,"count str":"757","local name":"$"},{"_index":93,"count":18,"count str":"18","local name":"!"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"count str","type":"nominal"}}}],"encoding":{"x":{"field":"count","type":"quantitative"},"y":{"field":"local name","type":"nominal","sort":{"field":"local name","op":"max"}}}};
      vegaEmbed('#viz_27286', yourVlSpec_viz_27286, {actions: false});
    </script></div><p>I couldn&apos;t find an official reference for what single character symbols are supported by clojure, but the <a href="https://github.com/edn-format/edn#symbols">edn spec</a> states that:</p><blockquote class="blockquote"><p>Symbols begin with a non-numeric character and can contain alphanumeric characters and <code>. * + ! - _ ? $ % &amp; = &lt; &gt;</code></p></blockquote><p>I like the idea of using Greek letters as locals, but I find using <code>|</code> or <code>!</code> as locals offensive.</p><blockquote class="blockquote"><p>Additionally, <code>:</code> and <code>#</code> are allowed as constituent characters in symbols other than as the first character.</p></blockquote><p>Does anybody do that? Well, there&apos;s only a single local that contains <code>#</code> in the name other than at the very end (which is used by syntax quote), but 21 repositories use locals with <code>:</code> in the name. It&apos;s not something I&apos;ve thought a lot about before, but now that I know that I can...</p><h2 id="Emoji-and-unicode-in-names">Emoji and unicode in names</h2><p>It&apos;s not clear if using emoji and unicode as var names is officially supported, but it&apos;s also not clear if it&apos;s not not supported<sup><a href="#footnote-6" name="footnote-ref-6" title="Clearly">6</a></sup>. I mean, it works when you type it into the repl:</p><div class="syntax"><pre><span class="symbol">user&gt;</span> <span class="s-exp">(</span><span class="special-form">def</span> <span class="symbol">😊</span> <span class="number">42</span><span class="s-exp">)</span>
<span class="reader-char">#&apos;</span><span class="symbol">user/😊</span>
<span class="symbol">user&gt;</span> <span class="s-exp">(</span><span class="core-fn">+</span> <span class="symbol">😊</span> <span class="symbol">😊</span><span class="s-exp">)</span>
<span class="number">84</span>
</pre></div><p>I&apos;m not saying it&apos;s a good idea. Anyway, there are 25 brave repositories that use emoji/unicode in var definition names. There is a single namespace that includes unicode.</p><p>Usages range from <a href="https://github.com/adereth/unicode-math">questionable</a> to <a href="https://github.com/jstepien/flip">╯°□°╯ ┻━┻</a>.</p><h1 id="Failed-Analyses">Failed Analyses</h1><p>For the 13% of repositories that aren&apos;t included, what went wrong?</p><div style="width:100%;overflow:scroll;">
<div id="viz_27287"></div>
  <script type="text/javascript">
      var yourVlSpec_viz_27287 = {"$schema":"https:\/\/vega.github.io\/schema\/vega-lite\/v5.json","description":null,"data":{"values":[{"_index":0,"count":1398,"count str":"1,398","fail type":":empty-analyses"},{"_index":1,"count":31,"count str":"31","fail type":":max-bytes-limit-exceeded"},{"_index":2,"count":45,"count str":"45","fail type":"java.lang.RuntimeException"},{"_index":3,"count":12,"count str":"12","fail type":"java.lang.IllegalArgumentException"},{"_index":4,"count":2,"count str":"2","fail type":"java.lang.NumberFormatException"},{"_index":5,"count":2,"count str":"2","fail type":"java.util.concurrent.ExecutionException"},{"_index":6,"count":10,"count str":"10","fail type":":download-error"},{"_index":7,"count":62,"count str":"62","fail type":"java.lang.OutOfMemoryError"},{"_index":8,"count":4,"count str":"4","fail type":"java.lang.InterruptedException"},{"_index":9,"count":128,"count str":"128","fail type":":no-findings"},{"_index":10,"count":1,"count str":"1","fail type":"java.lang.ThreadDeath"},{"_index":11,"count":6,"count str":"6","fail type":":read-error"}]},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","baseline":"middle","dx":3},"encoding":{"text":{"field":"count str","type":"nominal"}}}],"encoding":{"x":{"field":"count","type":"quantitative"},"y":{"field":"fail type","type":"nominal","sort":{"field":"count","op":"max"}}}};
      vegaEmbed('#viz_27287', yourVlSpec_viz_27287, {actions: false});
    </script></div><p>In the future, I&apos;d like to do a better job of breaking down what errors happened during analysis, but here&apos;s the coarse breakdown for now.</p><p>Descriptions:</p><ul><li><p><code>:empty-analyses</code>: No analysis was produced. The most common (only?) reason is that no project files were found (only deps.edn and project.clj supported).</p></li><li><p><code>:no-findings</code>: Analysis succeeded without error, but no findings were found. In theory, this could mean that everything worked and there was just nothing to analyze, but I&apos;m assuming that it&apos;s an error for now.</p></li><li><p>various Exceptions: Exceptions thrown while trying to analyze a project.</p></li><li><p><code>:max-bytes-limit-exceeded</code>: Repository checkout was over file size limit (currently 100Mb).</p></li><li><p><code>:download-error</code>: An exception was thrown while trying to download the repository from github.</p></li><li><p><code>:read-error</code>: Analyses for each repository were saved to intermediate files before being aggregated. This error means the resulting analysis file was unreadable.</p></li></ul><h1 id="Biases">Biases</h1><p>I guess I wouldn&apos;t say the data is biased so much as unrefined. I tried simply looking at the &quot;most popular X&quot; among usages, but you get misleading results if you don&apos;t account for biases like:</p><ul><li><p>popular libraries have more forks which amplify their usage patterns</p></li><li><p>outliers: a single or small number of repositories that do &quot;weird&quot; things can skew simple counts and averages</p></li><li><p>copy and pasting: for a number reasons, shared code is sometimes added to a repository by copy and pasting the code into a library rather than referencing the code as a dependency.</p></li><li><p>example and test code: test/example code can often exhibit very different usage patterns than &quot;normal&quot; code.</p></li><li><p>failed analyses: around ~87% of repositories were successfully analyzed. That&apos;s not terrible, but the 13% of libraries that failed to produce analysis probably aren&apos;t uncorrelated which can introduce biases.</p></li></ul><p>Most of these biases are pretty straightforward to account for and will hopefully be addressed in future work.</p><h1 id="Future-Work">Future Work</h1><p>Most language ecosystems have figured out that directly supporting community repositories/tools like clojars is a big win. Based on some smart design choices by clojure, its maintainers, and the community, I think that clojure is well positioned to take advantage of tools that work at the ecosystem level. I&apos;m not totally sure what other ecosystem tools look like, but I have some ideas.</p><h2 id="Mundane-Improvements">Mundane Improvements</h2><p>While the vision is to work on innovative ecosystem tooling, many of the planned improvements are mundane:</p><ul><li><p>crawl other open-source hosts besides github</p></li><li><p>improve support for clojurescript and other clojure dialects</p></li><li><p>automate more of the data gathering and analysis</p></li></ul><h2 id="Use-a-database">Use a database</h2><p>Currently, the full analysis of every clojure repository is made available as a giant 600+ MB gzipped edn file. It would be great to make the data available in a more organized, structured, and queryable format (like a database).</p><h2 id="Example-Usages">Example Usages</h2><p>Examples for clojure functions can be illustrative. It should be possible to pull up examples for <em>any</em> function.</p><h2 id="Improved-Code-Search">Improved Code Search</h2><p>Github search is bad. <a href="https://grep.app/">grep.app</a> is better, but a search tool that only targets clojure code could be much, much better!</p><h2 id="JavaJavascript-Interop">Java/Javascript Interop</h2><p>One of the common roadblocks for learning clojure/clojurescript is that you eventually need some amount of host interop to be productive. Finding commonly used java/javascript host interop can provide valuable input for improving learning resources with common interop knowledge or creating wrapper libraries for frequently required host APIs.</p><h2 id="Clojure-Specs">Clojure Specs</h2><p>Afaict, specs are designed with a global, universal orientation in mind. We should build tooling that leverages and supports this. As a simple example, building a searchable database of all specs should be straightforward.</p><h2 id="N-grams">N-grams</h2><blockquote class="blockquote"><p>In the fields of computational linguistics and probability, an n-gram (sometimes also called Q-gram) is a contiguous sequence of n items from a given sample of text or speech.<br /><footer class="blockquote-footer"><a href="https://en.wikipedia.org/wiki/N-gram">N-grams Wikipedia</a></footer></p></blockquote><p>I&apos;m not exactly sure what I&apos;d expect to find, but it would be interesting to find common patterns and idioms in clojure code.</p><h2 id="Namespace-Alias-usage">Namespace Alias usage</h2><p>It&apos;s common to use an alias when requiring a namespace. Since aliases are short, it&apos;s easy for multiple libraries to &quot;claim&quot; the same alias. I&apos;d like to build a database of all namespace alias usage so that it&apos;s easier to pick a preferred alias for your library that is less likely to conflict. This is probably a dumb idea, but at least it&apos;s an easy dumb idea.</p><h1 id="Related-Work">Related Work</h1><ul><li><p><a href="https://ericnormand.me/article/100-most-used-clojure-expressions">100 Most Used Clojure Expressions</a></p></li><li><p><a href="https://github.com/devn/getclojure">getclojure</a></p></li><li><p><a href="https://github.com/fbellomi/crossclj">crossclj</a></p></li></ul><h1 id="Footnotes">Footnotes</h1><div class="footnotes"><div><a href="#footnote-ref-1" name="footnote-1">1</a>. Nine projects were excluded because they are ginormous by themselves.</div><div><a href="#footnote-ref-2" name="footnote-2">2</a>. Clj-kondo also allows you to write your own linters, but that will have to wait for a future update.</div><div><a href="#footnote-ref-3" name="footnote-3">3</a>. See <a href="#Failed-Analyses">Failed Analyses</a>.</div><div><a href="#footnote-ref-4" name="footnote-4">4</a>. Here&apos;s a blog post explaining more about <code>iteration</code>. <a href="https://www.juxt.pro/blog/new-clojure-iteration">https://www.juxt.pro/blog/new-clojure-iteration</a> </div><div><a href="#footnote-ref-5" name="footnote-5">5</a>. CSS is hard</div><div><a href="#footnote-ref-6" name="footnote-6">6</a>. Clearly</div></div></div></div></div></div></div></body></html>